<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Controlling Where Callbacks Execute  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <meta property="og:site_name" content="Deferred Reference">
<meta property="og:description" content="An implementation of OCaml's Deferred for Swift. It lets you work with values that haven't been determined yet, like an array that's coming later from a web service call.">
<meta property="og:image" content="//www.bignerdranch.com/assets/img/logos/square-logo.jpeg">
<link rel="shortcut icon" type="image/x-icon" href="//www.bignerdranch.com/favicon.png">

    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>

    <a name="//apple_ref/swift/Section/Controlling Where Callbacks Execute" class="dashAnchor"></a>

    <a title="Controlling Where Callbacks Execute  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Deferred Docs
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bignerdranch/Deferred">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fbignerdranch%2Egithub%2Eio%2FDeferred%2Fdocsets%2FDeferred%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Deferred Reference</a>
      <img class="carat" src="img/carat.png" />
      Controlling Where Callbacks Execute  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Intuition.html">Intuition</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="why-deferred.html">Why Deferred?</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="basic-tasks.html">Basic Tasks</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="mastering-the-future-type.html">Mastering The Future Type</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="getting-started.html">Getting Started</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Futures%20and%20Promises.html">Futures and Promises</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Deferred.html">Deferred</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/FutureProtocol.html">FutureProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PromiseProtocol.html">PromiseProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Transforming%20Futures.html">Transforming Futures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Future.html">Future</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Sequence.html">Sequence</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Controlling%20Where%20Callbacks%20Execute.html">Controlling Where Callbacks Execute</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Executor.html">Executor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DispatchQueue.html">DispatchQueue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/OperationQueue.html">OperationQueue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/RunLoop.html">RunLoop</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CFRunLoop.html">CFRunLoop</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Futures%20Than%20Can%20Fail.html">Futures Than Can Fail</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task.html">Task</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task/Result.html">– Result</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/TaskProtocol.html">TaskProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Either.html">Either</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Coordinating%20Access%20to%20Data.html">Coordinating Access to Data</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Protected.html">Protected</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Locking.html">Locking</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Coordination%20Primitives.html">Coordination Primitives</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NativeLock.html">NativeLock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/POSIXReadWriteLock.html">POSIXReadWriteLock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DispatchSemaphore.html">DispatchSemaphore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSLock.html">NSLock</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other%20Typealiases.html#/s:8Deferred17PreferredExecutora">PreferredExecutor</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            <h1>Controlling Where Callbacks Execute</h1>
            
          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Deferred8ExecutorP"></a>
                    <a name="//apple_ref/swift/Protocol/Executor" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Deferred8ExecutorP">Executor</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>An executor calls closures submitted to it, typically in first-in, first-out
order on some other thread. An executor may also model locks or atomicity.</p>

<p>Throughout the Deferred module, <code>upon</code> methods (or parameters to methods
built around <code>upon</code>, such as <code>map</code>) are overloaded to take an <code>Executor</code>
as well as the standard <code>DispatchQueue</code>.</p>

<p>A custom executor is a customization point into the asynchronous semantics
of a future, and may be important for ensuring the thread safety of an
<code>upon</code> closure.</p>

<p>For instance, the concurrency model of Apple&rsquo;s Core Data framework requires
that objects be accessed from other threads using the <code>perform(_:)</code>
method, and not just thread isolation. Here, we connect that to Deferred:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">NSManagedObjectContext</span><span class="p">:</span> <span class="kt">Executor</span> <span class="p">{</span>

     <span class="kd">func</span> <span class="nf">submit</span><span class="p">(</span><span class="nv">body</span><span class="p">:</span> <span class="kd">@escaping</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
         <span class="nf">perform</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
     <span class="p">}</span>

<span class="p">}</span>
</code></pre>

<p>And use it like you would a dispatch queue, with <code>upon</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">NSManagedObjectContext</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">personJSON</span><span class="p">:</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">JSON</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">let</span> <span class="nv">person</span><span class="p">:</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Person</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">personJSON</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="nv">upon</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span> <span class="n">json</span> <span class="k">in</span>
    <span class="kt">Person</span><span class="p">(</span><span class="nv">json</span><span class="p">:</span> <span class="n">json</span><span class="p">,</span> <span class="nv">inContext</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

                        <a href="Protocols/Executor.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">Executor</span> <span class="p">:</span> <span class="kt">AnyObject</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:objc(cs)OS_dispatch_queue"></a>
                    <a name="//apple_ref/swift/Extension/DispatchQueue" class="dashAnchor"></a>
                    <a class="token" href="#/c:objc(cs)OS_dispatch_queue">DispatchQueue</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Dispatch queues invoke function bodies submitted to them serially in FIFO
order. A queue will only invoke one-at-a-time, but independent queues may
each invoke concurrently with respect to each other.</p>

                        <a href="Extensions/DispatchQueue.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">DispatchQueue</span><span class="p">:</span> <span class="kt"><a href="Protocols/Executor.html">Executor</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:objc(cs)NSOperationQueue"></a>
                    <a name="//apple_ref/swift/Extension/OperationQueue" class="dashAnchor"></a>
                    <a class="token" href="#/c:objc(cs)NSOperationQueue">OperationQueue</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>An operation queue manages a number of operation objects, making high
level features like cancellation and dependencies simple.</p>

<p>As an <code><a href="Protocols/Executor.html">Executor</a></code>, <code>upon</code> closures are enqueued as non-cancellable
operations. This is ideal for regulating the call relative to other
operations in the queue.</p>

                        <a href="Extensions/OperationQueue.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">OperationQueue</span><span class="p">:</span> <span class="kt"><a href="Protocols/Executor.html">Executor</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:objc(cs)NSRunLoop"></a>
                    <a name="//apple_ref/swift/Extension/RunLoop" class="dashAnchor"></a>
                    <a class="token" href="#/c:objc(cs)NSRunLoop">RunLoop</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A run loop processes events on a thread, and is a fundamental construct in
Cocoa applications.</p>

<p>As an <code><a href="Protocols/Executor.html">Executor</a></code>, submitted functions are invoked on the next iteration
of the run loop.</p>

                        <a href="Extensions/RunLoop.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">RunLoop</span><span class="p">:</span> <span class="kt"><a href="Protocols/Executor.html">Executor</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@T@CFRunLoopRef"></a>
                    <a name="//apple_ref/swift/Extension/CFRunLoop" class="dashAnchor"></a>
                    <a class="token" href="#/c:@T@CFRunLoopRef">CFRunLoop</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>A run loop processes events on a thread, and is a fundamental construct in
Cocoa applications.</p>

<p>As an <code><a href="Protocols/Executor.html">Executor</a></code>, submitted functions are invoked on the next iteration
of the run loop.</p>

                        <a href="Extensions/CFRunLoop.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">CFRunLoop</span><span class="p">:</span> <span class="kt"><a href="Protocols/Executor.html">Executor</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>© 2014-2018 <a class="link" href="//www.bignerdranch.com" target="_blank" rel="external">Big Nerd Ranch</a> under <a class="link" href="//github.com/bignerdranch/Deferred/blob/master/LICENSE" target="_blank" rel="external">MIT license</a>.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
