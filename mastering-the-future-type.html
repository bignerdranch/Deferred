<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Mastering The Future Type  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    <meta property="og:site_name" content="Deferred Reference">
<meta property="og:description" content="An implementation of OCaml's Deferred for Swift. It lets you work with values that haven't been determined yet, like an array that's coming later from a web service call.">
<meta property="og:image" content="//www.bignerdranch.com/assets/img/logos/square-logo.jpeg">
<link rel="shortcut icon" type="image/x-icon" href="//www.bignerdranch.com/favicon.png">

    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Mastering The Future Type  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Deferred Docs
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bignerdranch/Deferred">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fbignerdranch%2Egithub%2Eio%2FDeferred%2Fdocsets%2FDeferred%2Exml">
            <img class="header-icon" src="img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Deferred Reference</a>
      <img class="carat" src="img/carat.png" />
      Mastering The Future Type  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Intuition.html">Intuition</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="why-deferred.html">Why Deferred?</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="basic-tasks.html">Basic Tasks</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="mastering-the-future-type.html">Mastering The Future Type</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="getting-started.html">Getting Started</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Futures%20and%20Promises.html">Futures and Promises</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Deferred.html">Deferred</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/FutureProtocol.html">FutureProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/PromiseProtocol.html">PromiseProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Transforming%20Futures.html">Transforming Futures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Future.html">Future</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Collection.html">Collection</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Sequence.html">Sequence</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Controlling%20Where%20Callbacks%20Execute.html">Controlling Where Callbacks Execute</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Executor.html">Executor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DispatchQueue.html">DispatchQueue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/OperationQueue.html">OperationQueue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/RunLoop.html">RunLoop</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CFRunLoop.html">CFRunLoop</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Futures%20Than%20Can%20Fail.html">Futures Than Can Fail</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task.html">Task</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Task/Result.html">– Result</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/TaskProtocol.html">TaskProtocol</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Either.html">Either</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Coordinating%20Access%20to%20Data.html">Coordinating Access to Data</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Protected.html">Protected</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/Locking.html">Locking</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Coordination%20Primitives.html">Coordination Primitives</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/NativeLock.html">NativeLock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/POSIXReadWriteLock.html">POSIXReadWriteLock</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/DispatchSemaphore.html">DispatchSemaphore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/NSLock.html">NSLock</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other%20Typealiases.html#/s:8Deferred17PreferredExecutora">PreferredExecutor</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h2 id='mastering-the-future-type' class='heading'>Mastering The Future Type</h2>

<p>Deferred is designed to scale with the fundamentals you see above. Large applications can be built using just <code><a href="Structs/Deferred.html">Deferred</a></code> and its <code>upon</code> and <code>fill</code> methods.</p>
<h3 id='read-only-views' class='heading'>Read-Only Views</h3>

<p>It sometimes just doesn&rsquo;t make <em>sense</em> to be able to <code>fill</code> something; if you have a <code><a href="Structs/Deferred.html">Deferred</a></code> wrapping <code>UIApplication</code>&lsquo;s push notification token, what does it mean if someone in your codebase calls <code>fill</code> on it?</p>

<p>You may have noticed that anybody can call <code>upon</code> on a <code><a href="Structs/Deferred.html">Deferred</a></code> type; this is fundamental. But the same is true of <code>fill</code>, and this may be a liability as different pieces of code interact with each other. How can we make it <strong>read-only</strong>?</p>

<p>For this reason, Deferred is split into <code><a href="Protocols/FutureProtocol.html">FutureProtocol</a></code> and <code><a href="Protocols/PromiseProtocol.html">PromiseProtocol</a></code>, both protocols the <code><a href="Structs/Deferred.html">Deferred</a></code> type conforms to. You can think of these as the <q>reading</q> and <q>writing</q> sides of a deferred value; a future can only be <code>upon</code>ed, and a promise can only be <code>fill</code>ed.</p>

<p>Deferred also provides the <code><a href="Structs/Future.html">Future</a></code> type, a wrapper for anything that&rsquo;s a <code><a href="Protocols/PromiseProtocol.html">PromiseProtocol</a></code> much like the Swift <code>Any</code> types. You can use it protectively to make a <code><a href="Structs/Deferred.html">Deferred</a></code> read-only. Reconsider the example from above:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">FriendsViewController</span> <span class="p">{</span>

    <span class="c1">// `FriendsViewController` is the only of the `Deferred` in its</span>
    <span class="c1">// `Promise` role, and can use it as it pleases.</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">friends</span><span class="p">:</span> <span class="kt">Deferred</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;</span><span class="p">?</span>

    <span class="c1">// Now this method can vend a `Future` and not worry about the</span>
    <span class="c1">// rules of accessing its private `Deferred`.</span>
    <span class="kd">func</span> <span class="nf">refreshFriends</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Friend</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">friends</span> <span class="o">=</span> <span class="nf">fetchFriends</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">jimbob</span><span class="p">)</span>
        <span class="n">friends</span><span class="o">.</span><span class="nf">upon</span><span class="p">(</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span> <span class="n">friends</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">names</span> <span class="o">=</span> <span class="n">friends</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">names</span>
            <span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="cm">/* Stash the `Deferred&lt;Value&gt;` for defaulting later. */</span>
        <span class="k">self</span><span class="o">.</span><span class="n">friends</span> <span class="o">=</span> <span class="n">friends</span>

        <span class="k">return</span> <span class="kt">Future</span><span class="p">(</span><span class="n">friends</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">cancelFriends</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">friends</span><span class="p">?</span><span class="o">.</span><span class="nf">fill</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="p">[])</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>

<p>Use of the <code><a href="Structs/Future.html">Future</a></code> type isn&rsquo;t only defensive, it encapsulates and hides implementation details.</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">FriendsStore</span> <span class="p">{</span>

    <span class="c1">// dependency, injected later on</span>
    <span class="k">var</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">NSManagedObjectContext</span><span class="p">?</span>

    <span class="kd">func</span> <span class="nf">getLocalFriends</span><span class="p">(</span><span class="k">for</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Friend</span><span class="p">]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="n">context</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// a future can be created with an immediate value, allowing the benefits</span>
            <span class="c1">// of Deferred's design even if values are available already (consider a</span>
            <span class="c1">// stub object, for instance).</span>
            <span class="k">return</span> <span class="kt">Future</span><span class="p">([])</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">predicate</span><span class="p">:</span> <span class="kt">NSPredicate</span> <span class="o">=</span> <span class="cm">/* … */</span>

        <span class="k">return</span> <span class="kt">Friend</span><span class="o">.</span><span class="nf">findAll</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nv">inContext</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre>
<h3 id='other-patterns' class='heading'>Other Patterns</h3>

<p>As a codebase or team using Deferred gets larger, it may become important to reduce repetition and noise.</p>

<p>Deferred&rsquo;s abstractions can be extended using protocols. <a href="http://bignerdranch.github.io/Deferred/Protocols/FutureProtocol.html"><code><a href="Protocols/FutureProtocol.html">FutureProtocol</a></code></a> gives you all the power of the <code><a href="Structs/Deferred.html">Deferred</a></code> type on anything you build.</p>

<p>An example algorithm, included in Deferred, is the <code>IgnoringFuture</code>. Simply call <code>ignored()</code> to create a future that gets <q>filled</q> with <code>Void</code>:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">whenFriendsAreLoaded</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">IgnoringFuture</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">deferredFriends</span><span class="o">.</span><span class="nf">ignored</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>This method erases the <code>Value</code> of the <code><a href="Structs/Deferred.html">Deferred</a></code> without the boilerplate of creating a new <code><a href="Structs/Deferred.html">Deferred&lt;Void&gt;</a></code> and having to wait on an <code>upon</code>.</p>

<p>The <a href="http://bignerdranch.github.io/Deferred/Protocols/Executor.html"><code><a href="Protocols/Executor.html">Executor</a></code></a> protocol allows changing the behavior of an <code>upon</code> call, and any derived algorithm such as <code>map</code> or <code>andThen</code>. If your app isn&rsquo;t using a <code>DispatchQueue</code> directly, this allows you to adapt other asynchronous mechanisms like <code>NSManagedObjectContext.performBlock(_:)</code> for Deferred.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>© 2014-2018 <a class="link" href="//www.bignerdranch.com" target="_blank" rel="external">Big Nerd Ranch</a> under <a class="link" href="//github.com/bignerdranch/Deferred/blob/master/LICENSE" target="_blank" rel="external">MIT license</a>.</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.11.0</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
